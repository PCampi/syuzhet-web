<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Syuzhet web app</title>
    <meta name="description" content="Web abb to extract emotions from narratives.">
    <meta name="author" content="Pietro Campi">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {packages: ['corechart']});
        google.charts.setOnLoadCallback(function() {
            console.log("Google Charts loaded");
            $('#send_text_button').show();
        });
    </script>
</head>

<body style="width: 100%; margin: 0 10% 0 10%;">
    <h1>Wellcome to Syuzhet web interface.</h1>

    <form style="margin: 0 auto; width: 100%;" id="myForm">
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="min-width: 80%">
            <textarea class="mdl-textfield__input" type="text" rows="3" id="text_input"
            name="content"></textarea>
            <label class="mdl-textfield__label" for="text_input">Text to analyze...</label>
        </div>

        <div>
            <input type="button"
            class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored"
            value="Send text" id="send_text_button"/>
        </div>
    </form>

    <div class="emo-charts" id="barchart_material" style="height: 550px; width: 80%; margin-top: 30px; margin-bottom: 30px;">

    </div>
</body>

    <script>
        $(document).ready(function() {
            $('#send_text_button').hide();

            $('#send_text_button').on('click', function () {
                data_to_send = JSON.stringify({"content": String($("#text_input").val())})
                console.log(data_to_send);

                $.ajax({
                    url: 'https://syuzhet-web.herokuapp.com/analyze',
                    cache: false,
                    type: 'POST',
                    data : data_to_send,
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function(json_response) {
                        console.log('Done!');
                        console.log(json_response);

                        // create table data
                        var data = new google.visualization.DataTable();
                        var emotions = json_response["result"]["aggregate"];
                        var emo_names = json_response["emotion_names"];
                        var emo_colors = ['ff0000',
                                        'ffa854',
                                        'ff55ff',
                                        '009600',
                                        'ffff54',
                                        '5151ff',
                                        '59bdff',
                                        '54ff54'];

                        var data_arr = [
                            ['Emotion name', 'Intensity', {role: 'style'}]
                        ];

                        for (i = 2; i < emotions.length; i++) {
                            new_data = [emo_names[i], emotions[i], emo_colors[i]];
                            data_arr.push(new_data);
                        }

                        console.log(data_arr);

                        var data = new google.visualization.arrayToDataTable(data_arr, false)
                        // Set chart options
                        var options = {
                            chart: {
                                title: 'Emotions in your text',
                                subtitle: 'Computed by Syuzhet using EmoLex'
                            },
                            // backgroundColor: '#f5f5f5',
                            bars: 'horizontal' // Required for Material Bar Charts.
                        };

                        var chart = new google.visualization.BarChart(document.getElementById('barchart_material'));
                        chart.draw(data, options);
                    },
                    error: function(req, textStatus, errorThrown) {
                        console.log(req);
                        console.log(textStatus);
                        console.log(errorThrown);
                    }
                });
            });
        });
    </script>

</html>
